<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MiWebMusicStore - Toko Alat Musik Terlengkap di Indonesia</title>
  <meta name="description" content="Jual alat musik berkualitas dengan harga terbaik. Guitar, keyboard, drum, dan berbagai alat musik lainnya. Garansi resmi dan gratis konsultasi.">
  
  <!-- Import styles through Vite -->
  <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body class="font-sans antialiased bg-gray-50" data-variant="" data-current-variant="">
    <!-- Component containers -->
    <div id="language-selector-component" data-current-language="" data-current-variant=""></div>
    <div id="variant-selector-component" data-current-language="" data-current-variant=""></div>
    <div id="headerOffCanvas-component"></div> <!-- Header dengan off-canvas menu -->
    <div id="hero-component"></div>
    <div id="features-component"></div>
    <div id="product-categories-component"></div>
    <!-- <div id="products-component"></div> untuk module store/ecommerce -->
    <div id="productcatalogue-component"></div>
    <div id="stats-component"></div>
    <div id="brands-component"></div>
    <div id="about-component"></div>
    <div id="testimonials-component"></div>
    <div id="newsletter-component"></div>
    <div id="cta-component"></div>
    <div id="contact-component"></div>
    <div id="footer-component"></div>

    <!-- Load language system first (independent) -->
    <script type="module" src="/src/scripts/managers/LanguageManager.js"></script>
    
    <!-- Load variant system (independent) -->
    <script type="module" src="/src/scripts/managers/VariantManager.js"></script>
    
    <!-- Load language selector (independent) -->
    <script type="module" src="/src/scripts/components/LanguageSelector.js"></script>
    
    <!-- Load variant selector (independent) -->
    <script type="module" src="/src/scripts/components/VariantSelector.js"></script>

    <!-- Load HeaderOff Canvas -->
    <script type="module" src="/src/scripts/components/HeaderOffCanvas.js"></script>
    
    <!-- Load main app (without language/variant dependencies) -->
    <script type="module" src="/src/scripts/main.js"></script>
    
    <!-- Component State Updater Script -->
    <script type="module">
        import { variantConfig } from '/src/scripts/configs/variant.config.js';
        
        // Set default variant on body load
        document.addEventListener('DOMContentLoaded', function() {
            const body = document.body;
            const defaultVariant = variantConfig.defaultVariant;
            
            console.log(`üé® Setting default variant: ${defaultVariant}`);
            body.setAttribute('data-variant', defaultVariant);
            body.setAttribute('data-current-variant', defaultVariant);
            
            // Get current language (fallback to 'id' if not available)
            const defaultLanguage = localStorage.getItem('MiWebMusicStore_language') || 'id';
            console.log(`üåê Setting default language: ${defaultLanguage}`);
            
            // Update component containers with default values
            updateComponentAttributes(defaultLanguage, defaultVariant);
            
            // Also dispatch event for other components that might need to know
            window.dispatchEvent(new CustomEvent('defaultVariantSet', {
                detail: { variant: defaultVariant }
            }));
        });

        // Function to update component container attributes
        function updateComponentAttributes(language, variant) {
            const languageSelector = document.getElementById('language-selector-component');
            const variantSelector = document.getElementById('variant-selector-component');
            
            if (languageSelector) {
                if (language) languageSelector.setAttribute('data-current-language', language);
                if (variant) languageSelector.setAttribute('data-current-variant', variant);
            }
            
            if (variantSelector) {
                if (language) variantSelector.setAttribute('data-current-language', language);
                if (variant) variantSelector.setAttribute('data-current-variant', variant);
            }
            
            console.log(`üîÑ Updated component attributes - Language: ${language || 'unchanged'}, Variant: ${variant || 'unchanged'}`);
        }

        // Listen for language changes (from LanguageManager)
        window.addEventListener('languageManagerChanged', function(event) {
            const language = event.detail.newLanguage;
            console.log(`üåê Language changed event received: ${language}`);
            updateComponentAttributes(language, null);
        });

        // Also listen for the LanguageSelector event (for compatibility)
        window.addEventListener('languageChanged', function(event) {
            const language = event.detail.language;
            console.log(`üåê Language selector event received: ${language}`);
            updateComponentAttributes(language, null);
        });

        // Listen for variant changes (from VariantManager)
        window.addEventListener('variantChanged', function(event) {
            const variant = event.detail.variant;
            console.log(`üé® Variant changed event received: ${variant}`);
            updateComponentAttributes(null, variant);
        });

        // Also listen for the body attribute changes as fallback
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes') {
                    if (mutation.attributeName === 'data-current-variant') {
                        const variant = document.body.getAttribute('data-current-variant');
                        if (variant) {
                            updateComponentAttributes(null, variant);
                        }
                    }
                }
            });
        });

        // Start observing the body element for attribute changes
        observer.observe(document.body, {
            attributes: true,
            attributeFilter: ['data-current-variant', 'data-current-language']
        });
    </script>
    
    
    <!-- Component Loader Script -->
    <script>
        // Function to load component
        async function loadComponent(componentName, containerId) {
            try {
                console.log(`üîß Loading component: ${componentName}`);
                const response = await fetch(`/src/components/${componentName}.html`);
                const html = await response.text();
                document.getElementById(containerId).innerHTML = html;
                console.log(`‚úÖ Component loaded: ${componentName}`);
            } catch (error) {
                console.error(`‚ùå Error loading component ${componentName}:`, error);
            }
        }

        // Load all components
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üîß Loading components...');
            
            const components = [
                { name: 'language-selector', id: 'language-selector-component' },
                { name: 'variant-selector', id: 'variant-selector-component' },
                { name: 'headerOffCanvas', id: 'headerOffCanvas-component' },
                { name: 'hero', id: 'hero-component' },
                { name: 'features', id: 'features-component' },
                { name: 'productCategories', id: 'product-categories-component' },
                // { name: 'products', id: 'products-component' },
                { name: 'productsCatalogue', id: 'productcatalogue-component' },
                { name: 'stats', id: 'stats-component' },
                { name: 'brands', id: 'brands-component' },
                { name: 'about', id: 'about-component' },
                { name: 'testimonials', id: 'testimonials-component' },
                { name: 'newsletter', id: 'newsletter-component' },
                { name: 'cta', id: 'cta-component' },
                { name: 'contact', id: 'contact-component' },
                { name: 'footer', id: 'footer-component' }
            ];

            // Load components in parallel
            const loadPromises = components.map(component => 
                loadComponent(component.name, component.id)
            );

            await Promise.all(loadPromises);
            console.log('‚úÖ All components loaded successfully');

            // Trigger a custom event to signal components are loaded
            window.dispatchEvent(new CustomEvent('componentsLoaded'));
        });
    </script>
</body>
</html>
